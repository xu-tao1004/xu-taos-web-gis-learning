<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>图层控制 - 本地切片叠加高德地图</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.4.0/dist/ol.css" />
  <script src="https://cdn.jsdelivr.net/npm/ol@7.4.0/dist/ol.js"></script>
  <!-- 引入Font Awesome图标库（用于按钮图标） -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    #map {
      width: 100%;
      height: 800px;
    }

    /* 图层控制按钮样式 */
    .layer-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 100; /* 确保在地图上方显示 */
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .layer-btn {
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .layer-btn:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    .layer-btn.active {
      background: #e6f7ff;
      border-color: #1890ff;
      color: #1890ff;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- 图层控制按钮容器 -->
  <div class="layer-controls">
    <button id="gaodeBtn" class="layer-btn active">
      <i class="fas fa-map"></i>
      <span>关闭高德底图</span>
    </button>
    <button id="tileBtn" class="layer-btn active">
      <i class="fas fa-layer-group"></i>
      <span>关闭切片图层</span>
    </button>
  </div>

  <script>
    // 1. 高德地图底图
    const gaodeSource = new ol.source.XYZ({
      url: 'http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}',
      projection: 'EPSG:3857',
      maxZoom: 18
    });

    const gaodeLayer = new ol.layer.Tile({
      source: gaodeSource,
      zIndex: 1,
      visible: true  // 初始可见
    });

    // 2. 本地切片图层
    const localTileSource = new ol.source.XYZ({
      url: '新建文件夹 (3)/{z}/{x}/{y}.png',
      projection: 'EPSG:3857',
      maxZoom: 20,
      minZoom: 15,
      tileUrlFunction: function(tileCoord) {
        if (!tileCoord) return undefined;
        const z = tileCoord[0];
        const x = tileCoord[1];
        let y = tileCoord[2];
        y = -y - 1;  // 根据实际切片调整
        return `新建文件夹 (3)/${z}/${x}/${y}.png`;
      }
    });

    const localTileLayer = new ol.layer.Tile({
      source: localTileSource,
      zIndex: 2,
      visible: true  // 初始可见
    });

    // 3. 创建地图
    const map = new ol.Map({
      target: 'map',
      layers: [gaodeLayer, localTileLayer],
      view: new ol.View({
        projection: 'EPSG:3857',
        center: ol.proj.fromLonLat([115.531, 29.7888]),
        zoom: 17
      })
    });

    // 4. 图层控制逻辑
    // 获取按钮元素
    const gaodeBtn = document.getElementById('gaodeBtn');
    const tileBtn = document.getElementById('tileBtn');

    // 高德底图控制
    gaodeBtn.addEventListener('click', function() {
      const isVisible = gaodeLayer.getVisible();
      // 切换可见性
      gaodeLayer.setVisible(!isVisible);
      // 更新按钮状态和文本
      if (!isVisible) {
        gaodeBtn.classList.add('active');
        gaodeBtn.innerHTML = '<i class="fas fa-map"></i><span>关闭高德底图</span>';
      } else {
        gaodeBtn.classList.remove('active');
        gaodeBtn.innerHTML = '<i class="fas fa-map"></i><span>打开高德底图</span>';
      }
    });

    // 切片图层控制
    tileBtn.addEventListener('click', function() {
      const isVisible = localTileLayer.getVisible();
      // 切换可见性
      localTileLayer.setVisible(!isVisible);
      // 更新按钮状态和文本
      if (!isVisible) {
        tileBtn.classList.add('active');
        tileBtn.innerHTML = '<i class="fas fa-layer-group"></i><span>关闭切片图层</span>';
      } else {
        tileBtn.classList.remove('active');
        tileBtn.innerHTML = '<i class="fas fa-layer-group"></i><span>打开切片图层</span>';
      }
    });
  </script>
</body>
</html>
